# 贝叶斯方法 Bayesian methods

用途: 用于更新我们对未知量的信念
相关概念: 非参数贝叶斯方法 (https://www.notion.so/7dc920f442ae44d5bc3fbb8f98d12512?pvs=21) 高斯过程回归（GPR） (https://www.notion.so/GPR-e5038509cad942ff83e4075483fd18bb?pvs=21)

[https://www.desmos.com/calculator/zgofwnzli8](https://www.desmos.com/calculator/zgofwnzli8)

<aside>
💡 我在desmos上给出了贝叶斯方法的可视化demo：
案例1：[贝叶斯方法 - 投硬币例子](https://www.desmos.com/calculator/ghohmglw47)：假设θ服从均匀分布
案例2：[贝叶斯方法-掷硬币例：假设θ服从高斯分布 (desmos.com)](https://www.desmos.com/calculator/zgofwnzli8)

</aside>

贝叶斯方法是一种统计学上的方法，它**使用观察到的样本数据来更新我们对未知量的信念(bilief)。**

在这个过程中，我们开始时对未知量有一个先验概率分布，即假设这个未知量的概率分布（例如，我们可以假设数据来自高斯分布，均匀分布，或者其他一些分布），这个先验分布反映了我们在观察数据之前对未知量的信念。然后，当我们收集到数据后，我们用贝叶斯定理来计算出各种先验假设在这些观测样本下的后验概率，这个后验分布反映了我们在观察到数据后对未知量的信念。最后，可以根据后验概率来更新对未知量的信念。

具体来说，假设我们有一些数据，我们的目标是估计一个模型参数θ。我们对θ有一个先验分布p(θ)，这反映了我们在观察数据之前对θ的信念。然后，我们根据数据计算θ各种取值的可能性，也就是在给定θ的条件下，观察到这些数据的概率p(D|θ)。最后，我们用贝叶斯定理计算出θ的后验分布p(θ|D)，这反映了我们在观察到数据后对θ的信念：

p(θ|D) = p(D|θ)p(θ) / p(D)

值得注意的是，贝叶斯方法提供了一种在收集数据后更新信念的形式化方法，但是它仍然**依赖于合理的先验信念。如果我们的先验信念非常错误，那么即使使用贝叶斯方法，我们的结果也可能会有误。**因此，模型的选择和评估是一个需要谨慎对待的问题。

## 案例：硬币投掷正面朝上的概率估计

我们可以通过一个硬币投掷的例子来详细说明如何使用贝叶斯方法来更新模型参数。

假设我们有一个硬币，并且我们想要确定这个硬币正面朝上的概率 *θ*。我们可以将这个概率看作是一个模型参数，我们想要估计这个参数。

### **步骤1：设定先验分布**

首先，我们需要设定一个先验分布来表示我们在收集任何数据之前对θ的信念。假设我们没有任何关于*θ*的信息，那么我们可以认为*θ*在0和1之间的任何值都是等可能的。这可以用均匀分布来表示，即p(*θ*) = 1，对所有0 ≤ *θ* ≤ 1。

### **步骤2：收集数据**

然后，我们开始投掷硬币并记录结果。假设我们投掷了10次硬币，其中有7次正面朝上。

### **步骤3：计算似然性**

接下来，我们需要计算似然性，即在给定θ的条件下，观察到这些数据的概率。这可以用二项分布来计算：

$$
p(D|\theta) = \binom{10}{7}\theta^{7}(1-\theta)^{3}
$$

这个公式告诉我们，在给定θ的情况下，投掷10次硬币，其中7次正面朝上的概率有多大。

### **步骤4：计算后验分布**

**计算原始假设参数θ的后验概率分布，即θ的的条件概率密度函数 p(θ|D)**

最后，我们用贝叶斯定理来计算后验分布：

$$
p(\theta|D) = \frac{p(D|\theta)p(\theta)}{p(D)}
$$

这里，p(D)是所有可能的θ值下，观察到数据的概率，它可以通过对所有可能的θ值求和来计算。然而，在这个例子中，我们并不需要精确地计算p(D)，因为我们只对比θ的不同值时，后验概率的相对大小感兴趣。因此，我们可以忽略分母，只需要计算分子部分：

$$
p(\theta|D) \propto p(D|\theta)p(\theta) = \binom{10}{7}\theta^{7}(1-\theta)^{3} \cdot 1
$$

这个公式告诉我们，在观察到7次正面朝上的数据后，不同的θ值的后验概率。

p(D)根据全概率公式有 ：
p(D) = ∫ P(D|θ)×p(θ) dθ

$P\left(D\right)=\int_{0}^{1}c\cdot\theta^{h}\left(1-\theta\right)^{\left(N-h\right)}d\theta$

### **步骤5：解析后验分布**

在这个例子中，由于我们选择的是均匀先验，该后验概率p(θ|D)的形式是一个[**Beta分布**](https://www.notion.so/1a9605817c1c4fe8bdd6fd18694f32a4?pvs=21)，如果我们画出这个公式的图像，我们会看到它的峰值在θ=0.7附近，这是我们的最大后验估计（MAP estimate）。这个分布也告诉我们关于θ的不确定性：θ的值可能在0.5到0.9之间，但是更接近0.7的值更有可能。

![beta分布：β(x, a=8, b=4)
Beta 分布是二项分布的共轭先验，这意味着当先验分布和似然性是共轭的时，后验分布和先验分布具有相同的形式。](%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%96%B9%E6%B3%95%20Bayesian%20methods%20daa494fc7ff64b0f81c5977f45f6937b/Untitled.png)

beta分布：β(x, a=8, b=4)
Beta 分布是二项分布的共轭先验，这意味着当先验分布和似然性是共轭的时，后验分布和先验分布具有相同的形式。

### 分析

1） p(θ|D)是一个beta分布

2) 如下图，当观测事件D的投掷次数N越大时，θ的后验beta分布越集中。这说明，随着抛硬币这个随机试验测次数越大，我们对“选择θ等于出现人头的频率”的信心越大。
<!-- 使用 HTML 标签将两张图片放在一行 -->
<div style="display: flex;">
  <img src="%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%96%B9%E6%B3%95%20Bayesian%20methods%20daa494fc7ff64b0f81c5977f45f6937b/Untitled%201.png" alt="N=10, h=7" style="width: 50%; margin: 5px;">
  <img src="%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%96%B9%E6%B3%95%20Bayesian%20methods%20daa494fc7ff64b0f81c5977f45f6937b/Untitled%202.png" alt="N=100, h=70" style="width: 50%; margin: 5px;">
</div>


3）虽然对θ似然函数的最大值也是人头的频率，但这并不足以支撑我们对θ估计的信心。因为注意到，θ似然函数的分布相对扁平。而且

在上面的案例中，我们对出现人头的概率θ的基础假设是θ服从[0,1]上的均匀分布，极大似然和后验分布具有一致的解析形式，它们取最大值的θ是相同的。下面我们看如果对θ做不同假设的情况。

如果我们认为，人头的概率θ极有可能是0.3，这可以看作我们对θ的初始信心。那么我们令θ服从均值为0.3，方差很小的高斯分布，有θ~N(0.3, 0.01)。假设我们观测到的事件D为：我们投掷了10次硬币，其中有9次正面朝上，即N=10, h=9。

我们分别画出了θ似然函数和θ的后验分布，如图所示。似然函数表示，θ在0.9处取得极大似然。可以明显地看到两者的有巨大的错位。θ后验概率表示，θ可能集中在0.5附近。

![θ~N(0.3, 0.01), N=10, h=9](%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%96%B9%E6%B3%95%20Bayesian%20methods%20daa494fc7ff64b0f81c5977f45f6937b/Untitled%203.png)

θ~N(0.3, 0.01), N=10, h=9

在本案例中，似然函数最大值的θ与后验分布最大概率密度的θ是不同的（在之前的案例中，假设θ服从均匀分布，θ的概率密度取常数值，使得θ后验概率与似然函数的形式一致）。θ服从高斯分布，使得θ后验概率与似然函数的形式不一致。随着观测到的事件不同（即出现head面的频率变化），这两个最大值的θ是有错位的。

**本案例也说明了，使用极大似然方法得到的参数估计，我们仍然不能对此抱有有足够的信心。**并且，如果对θ的初始假设与真实观测偏差过大时，我们需要使用后验概率更新我们对θ分布的观点。后验概率是根据我们对θ参数的初始信心和观测值共同决定的，也并不代表θ的真实分布，但是可以通过后验概率来更新我们对θ假设的信心。

这就是使用贝叶斯方法更新模型参数的过程。我们开始时有一个对θ的先验信念，然后我们观察到一些数据，我们用这些数据和贝叶斯定理来更新我们的信念，得到后验分布。后验分布不仅给出了θ的最有可能的值，还给出了θ的不确定性，这是贝叶斯方法的一个重要特性。